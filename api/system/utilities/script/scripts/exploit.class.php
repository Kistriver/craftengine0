<?php
namespace CRAFTEngine\core\scripts;

header('Content-type: application/json; charset=utf-8');

set_time_limit(0);
ignore_user_abort(1);

class exploit
{
	public function __construct($core)
	{
		$version = $core::CORE_VER;
		$url = 'http://stat.kcraft.su/api/v5/stat/exploit/get/craftengine/{"product":"CRAFTEngine","version":"'.$version.'"}';
		$context = stream_context_create
		(
			array
			(
				'http' => array
				(
					'method' => 'GET',
					'header' => 'Content-Type: application/x-www-form-urlencoded'.PHP_EOL.
					'User-agent: CraftEngine('.$core->conf->system->core->version.')',
				)
			)
		);

		echo $answer = @file_get_contents($url,false,$context);

		$answer_decode = json_decode($answer, true);
		if(!$answer_decode)
		{

		}
		else
		{
			if(sizeof($answer_decode['errors'])==0)
			{
				$answer_decode['data']['time'] = time();
				file_put_contents($core->getParams()['root'].'cache/Exploit',json_encode($answer_decode['data']));
			}
		}
	}
}